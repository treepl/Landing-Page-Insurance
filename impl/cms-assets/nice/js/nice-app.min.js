'use strict';(function(){function p(){q();let a={key:"JA2A2A5D3qB1F1A4C3I1A15C11D3E6F6dVh1VCQWa1EOQFe1NCb1==",toolbarInline:!0,charCounterCount:!1,toolbarButtons:"bold italic underline strikeThrough subscript superscript - insertLink color selectAll clearFormatting | undo redo".split(" "),htmlAllowedTags:"a br em s span strong sub sup u nice_editable_text".split(" "),htmlUntouched:!0,autofocus:!0,zIndex:99999,linkInsertButtons:["linkBack"],linkList:[]};$(document).off("click",'nice_editable_text:not([data-not_froala="true"])').on("click",
'nice_editable_text:not([data-not_froala="true"])',function(){let c=$(this),b=c.data("holder_id"),d=c.data("text_id"),e=l[b].PropertyType,f=l[b].Type;"Umbraco.TextboxMultiple"!==e&&"Template"!==f&&"File"!==f&&"Layout"!==f&&"Snippet"!==f&&"Form"!==f&&"Umbraco.TinyMCEv3"!==e||c.find(".fr-wrapper").length||($("nice_editable_text").froalaEditor("destroy"),setTimeout(()=>{$("nice_editable_text").off("froalaEditor.blur");$("nice_editable_text").off("froalaEditor.contentChanged");c.froalaEditor(a);c.on("froalaEditor.blur",
function(a,e){c.froalaEditor("destroy");setTimeout(()=>{c.off("froalaEditor.blur");c.off("froalaEditor.contentChanged");m(b,d,c.html())},0)});c.on("froalaEditor.contentChanged",function(a,b){c.attr("data-property_changed",!0)})},0))});$(document).on("keyup keypress",'nice_editable_text[data-not_froala="true"]',function(){$(this).attr("data-property_changed",!0)});$(document).on("focusout",'nice_editable_text[data-not_froala="true"]',function(){let a=$(this),b=a.html().replace(/<br\s*\/?>/gm,"\r\n");
b=b.replace(/(<(\/?[^>]+)>)/gm,"");b=b.replace(/\r\n/gm,"<br />");b=b.replace(/<br\s*\/?>\s*$/g,"");a.html(b);m(a.data("holder_id"),a.data("text_id"),b)})}function q(){$(document).on("click","button",'input[type="button"]',function(){return!1});$("a, button").removeClass("waves-effect");$("label").removeAttr("for");$("form").removeAttr("action");setInterval(function(){$("body").attr("contenteditable")&&$("body").removeAttr("contenteditable")},100);$("[onclick]").each(function(){var a=$(this),c=a.attr("onclick");
a.attr("ondblclick",c).removeAttr("onclick")});$(document).on("dblclick","a[data-href]",function(){var a=$(this);if(a.data("href").length||"#"!=a.data("href")||"javascript:"!=a.data("href"))window.location=a.data("href");return!1});$(document).on("click",function(){$("*").each(function(){$(this)[0].onselectstart=null})});$("nice_editable_text").each(function(){var a=$(this);let c=a.data("holder_id"),b=a.data("text_id"),d=l[c].PropertyType,e=l[c].Type,f=a.text();"Umbraco.TextboxMultiple"!==d&&"Template"!==
e&&"Form"!==e&&"File"!==e&&"Layout"!==e&&"Snippet"!==e&&"Umbraco.TinyMCEv3"!==d?(a.attr("contenteditable",!0),a.attr("data-not_froala",!0)):(a=r(a,f),"nice_editable_text"!==a.nodeName.toLowerCase()&&(a.getElementsByTagName("nice_editable_text")[0].parentElement.replaceChild(document.createTextNode(f),a.querySelector("nice_editable_text")),$(a).wrap(`<nice_editable_text data-holder_id="${c}" data-text_id="${b}">`)))});$("a").each(function(){var a=$(this);a.attr("href")?0!=a.attr("href").indexOf("#")&&
"javascript:"!=a.attr("href")?a.find("nice_editable_text").length&&(a.attr("data-href",a.attr("href")),a.attr("href","javascript:")):a.attr("href","javascript:"):a.attr("href","javascript:")});$(document).off("click","nice_editable_text a").on("click","nice_editable_text a",function(a){a.preventDefault()})}function m(a,c,b){a=document.querySelectorAll(`nice_editable_text[data-holder_id="${a}"][data-text_id="${c}"]`);for(c=0;c<a.length;c++)a[c].innerHTML=b}function r(a,c){let b="a br em s span strong sub sup u".split(" "),
d=a.parents();a=a[0];for(let e=0;e<d.length;e++){let f=d[e].nodeName.toLowerCase(),h=d[e].textContent;if(-1!==b.findIndex((a)=>a===f)&&h.trim()===c.trim())a=d[e];else return a}}function n(a,c){let b=a.parentElement;return-1!=="a br em s span strong sub sup u".split(" ").findIndex((a)=>a===b.nodeName.toLowerCase())&&b.textContent.trim()===c.trim()?n(b,c):a}function t(){$(document).on("click",".niceSaveBtn:not(.saved)",function(){let a=[],c=!1;$(".niceSaveBtn").addClass("saved");$('[data-property_changed="true"]').each((b,
d)=>{var e=d.dataset.holder_id,f=d.dataset.text_id;b=l[e];if("Umbraco.TextboxMultiple"===b.PropertyType||"Template"===b.Type||"File"===b.Type||"Layout"===b.Type||"Form"===b.Type||"Snippet"===b.Type||"Umbraco.TinyMCEv3"===b.PropertyType){let a,g=decodeURIComponent(b.Layout);g=g.replace(/<(img|hr|br|input)(>)|<((img|hr|br|input)[^>]*?[^\/])(>)/gim,"<$1$3 /$2$5");g=g.replace(/(<[^\/>][^>]*>)(<\/[^>]+>)/gim,"$1var$2");g=g.replace(/&/gim,"&amp;");g=u(g);a="Template"===b.Type||-1!==g.indexOf("</head>")?
(new DOMParser).parseFromString(g,"text/xml"):(new DOMParser).parseFromString(`<html><head></head><body>${g}</body></html>`,"text/xml");if(a.querySelector("parsererror"))return alert(`This page contains the following errors:\n\r ${a.querySelector("parsererror").querySelector("div").innerText}`),c=!0,!1;e=a.querySelectorAll(`nice_editable_text[data-holder_id="${e}"][data-text_id="${f}"]`);for(f=0;f<e.length;f++){var h=e[f],k=h.textContent;k=k.replace("/&/gim","&amp;");let a=n(h,k);"nice_editable_text"!==
a.nodeName.toLowerCase()?(h=a,k=document.createElement("nice_editable_text"),h.parentNode.insertBefore(k,h),k.appendChild(h),a.parentElement.innerHTML=""!==d.innerHTML?d.innerHTML:"var"):a.innerHTML=""!==d.innerHTML?d.innerHTML:"var"}"Template"!==b.Type||-1===g.indexOf("</head>")?(d=a.getElementsByTagName("body")[0].innerHTML,b.Layout=encodeURIComponent(d.replace(/>var?<\//gim,"></").replace(/&amp;/gim,"&"))):(d=(new XMLSerializer).serializeToString(a),b.Layout=encodeURIComponent(d.replace(/>var?<\//gim,
"></")))}else b.Layout=d.innerHTML;a.push(b)});a.forEach((a)=>{let b=decodeURIComponent(a.Layout);a.Layout=encodeURIComponent(b.replace(/(<nice_editable_text .+?>)([\s\S]*?)(<\/nice_editable_text>)/g,"$2"))});c||$.ajax("/api/nice-editor-items/save",{type:"PUT",data:JSON.stringify(a),contentType:"application/json",success:function(){location.reload()},error:function(a){alert(a.message);location.reload()}});return!1});$(document).on("click",".nICE-clear-btn",function(){window.location=window.location.pathname+
"?nice=0";return!1});$("body").append('<div class="nICE-control-panel">\n\t\t<button class="nICE-btn niceSaveBtn">\n\t\t\tSave\n\t\t\t<svg class="nICE-spinner" width="17px" height="17px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n\t\t\t</svg>\n\t\t</button>\n\t\t<button class="nICE-clear-btn">EXIT nICE</button>\n\t</div>')}function u(a){let c=/((^|"|')\s+?)(([a-z0-9_-]+?(($|\s+)))+)/gi;
var b=a.matchAll(/<[a-z0-9_-]+([^>]*?\s([a-z0-9_-]+?(?=(\s|>)))[^>]*?)>/gi);for(const e of b){b=e[0];var d=e[1];let f=d.replace(c,function(a){return a.replace(/([a-z0-9_-])(\s|$)/gi,'$1=""$2')});d=b.replace(d,f);a=a.replace(b,d)}return a}var l=window.nicePropertiesScope;document.addEventListener("DOMContentLoaded",function(a){t();p()});String.prototype.matchAll=function(a){var c=[];this.replace(a,function(){var a=[].slice.call(arguments,0),d=a.splice(-2);a.index=d[0];a.input=d[1];c.push(a)});return c.length?
c:[]}})();
