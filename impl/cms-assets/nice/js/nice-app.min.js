'use strict';(function(b){function q(){r();let a={key:"JA2A2A5D3qB1F1A4C3I1A15C11D3E6F6dVh1VCQWa1EOQFe1NCb1==",toolbarInline:!0,charCounterCount:!1,toolbarButtons:"bold italic underline strikeThrough subscript superscript - insertLink color selectAll clearFormatting | undo redo".split(" "),htmlAllowedTags:"a br em s span strong sub sup u nice-editable-text".split(" "),htmlUntouched:!0,autofocus:!0,zIndex:99999,linkInsertButtons:["linkBack"],linkList:[]};b(document).off("click",'nice-editable-text:not([data-not_froala="true"])').on("click",
'nice-editable-text:not([data-not_froala="true"])',function(){let e=b(this),c=e.data("holder_id"),d=e.data("text_id"),g=m[c].PropertyType,f=m[c].Type;"Umbraco.TextboxMultiple"!==g&&"Template"!==f&&"File"!==f&&"Layout"!==f&&"Snippet"!==f&&"Form"!==f&&"Umbraco.TinyMCEv3"!==g||e.find(".fr-wrapper").length||(b("nice-editable-text").froalaEditor("destroy"),setTimeout(()=>{b("nice-editable-text").off("froalaEditor.blur");b("nice-editable-text").off("froalaEditor.contentChanged");e.froalaEditor(a);e.on("froalaEditor.blur",
function(a,b){e.froalaEditor("destroy");setTimeout(()=>{e.off("froalaEditor.blur");e.off("froalaEditor.contentChanged");n(c,d,e.html())},0)});e.on("froalaEditor.contentChanged",function(a,c){e.attr("data-property_changed",!0)})},0))});b(document).on("keyup keypress",'nice-editable-text[data-not_froala="true"]',function(){b(this).attr("data-property_changed",!0)});b(document).on("focusout",'nice-editable-text[data-not_froala="true"]',function(){let a=b(this),c=a.html().replace(/<br\s*\/?>/gm,"\r\n");
c=c.replace(/(<(\/?[^>]+)>)/gm,"");c=c.replace(/\r\n/gm,"<br />");c=c.replace(/<br\s*\/?>\s*$/g,"");a.html(c);n(a.data("holder_id"),a.data("text_id"),c)})}function r(){b(document).on("click","button",'input[type="button"]',function(){return!1});b("a, button").removeClass("waves-effect");b("label").removeAttr("for");b("form").removeAttr("action");setInterval(function(){b("body").attr("contenteditable")&&b("body").removeAttr("contenteditable")},100);b("[onclick]").each(function(){var a=b(this),e=a.attr("onclick");
a.attr("ondblclick",e).removeAttr("onclick")});b(document).on("dblclick","a[data-href]",function(){var a=b(this);if(a.data("href").length||"#"!=a.data("href")||"javascript:"!=a.data("href"))window.location=a.data("href");return!1});b(document).on("click",function(){b("*").each(function(){b(this)[0].onselectstart=null})});b("nice-editable-text").each(function(){var a=b(this);let e=a.data("holder_id"),c=a.data("text_id"),d=m[e].PropertyType,g=m[e].Type,f=a.text();"Umbraco.TextboxMultiple"!==d&&"Template"!==
g&&"Form"!==g&&"File"!==g&&"Layout"!==g&&"Snippet"!==g&&"Umbraco.TinyMCEv3"!==d?(a.attr("contenteditable",!0),a.attr("data-not_froala",!0)):(a=t(a,f),"nice-editable-text"!==a.nodeName.toLowerCase()&&(a.getElementsByTagName("nice-editable-text")[0].parentElement.replaceChild(document.createTextNode(f),a.querySelector("nice-editable-text")),b(a).wrap(`<nice-editable-text data-holder_id="${e}" data-text_id="${c}">`)))});b("a").each(function(){var a=b(this);a.attr("href")?0!=a.attr("href").indexOf("#")&&
"javascript:"!=a.attr("href")?a.find("nice-editable-text").length&&(a.attr("data-href",a.attr("href")),a.attr("href","javascript:")):a.attr("href","javascript:"):a.attr("href","javascript:")});b(document).off("click","nice-editable-text a").on("click","nice-editable-text a",function(a){a.preventDefault()})}function n(a,e,c){a=document.querySelectorAll(`nice-editable-text[data-holder_id="${a}"][data-text_id="${e}"]`);for(e=0;e<a.length;e++)a[e].innerHTML=c}function t(a,e){let c="a br em s span strong sub sup u".split(" "),
d=a.parents();a=a[0];for(let b=0;b<d.length;b++){let f=d[b].nodeName.toLowerCase(),g=d[b].textContent;if(-1!==c.findIndex((a)=>a===f)&&g.trim()===e.trim())a=d[b];else return a}}function p(a,b){let c=a.parentNode;return-1!=="a br em s span strong sub sup u".split(" ").findIndex((a)=>a===c.nodeName.toLowerCase())&&c.textContent.trim()===b.trim()?p(c,b):a}function u(){b(document).on("click",".niceSaveBtn:not(.saved)",function(){let a=[],e=!1;b(".niceSaveBtn").addClass("saved");b(".niceExitBtn").hide();
document.querySelectorAll('[data-property_changed="true"]').forEach((c,d)=>{var g=c.dataset.holder_id,f=c.dataset.text_id;d=m[g];if("Umbraco.TextboxMultiple"===d.PropertyType||"Template"===d.Type||"File"===d.Type||"Layout"===d.Type||"Form"===d.Type||"Snippet"===d.Type||"Umbraco.TinyMCEv3"===d.PropertyType){let a,h=decodeURIComponent(d.Layout);h=h.replace(/<(img|hr|br|input)(>)|<((img|hr|br|input)[^>]*?[^\/])(>)/gim,"<$1$3 /$2$5");h=h.replace(/(<[^\/>][^>]*>)(<\/[^>]+>)/gim,"$1var$2");h=h.replace(/&/gim,
"&amp;");h=v(h);a="Template"===d.Type||-1!==h.indexOf("</head>")?(new DOMParser).parseFromString(h,"text/xml"):(new DOMParser).parseFromString(`<html><head></head><body>${h}</body></html>`,"text/xml");if(a.querySelector("parsererror"))return alert(`This page contains the following errors:\n\r ${a.querySelector("parsererror").querySelector("div").innerText}`),e=!0,b(".niceSaveBtn").removeClass("saved"),!1;g=a.querySelectorAll(`nice-editable-text[data-holder_id="${g}"][data-text_id="${f}"]`);for(f=
0;f<g.length;f++){var k=g[f],l=k.textContent;l=l.replace("/&/gim","&amp;");let a=p(k,l);"nice-editable-text"!==a.nodeName.toLowerCase()?(k=a,l=document.createElement("nice-editable-text"),k.parentNode.insertBefore(l,k),l.appendChild(k),""!==c.innerHTML?a.outerHTML=c.innerHTML:a.parentElement.innerHTML="var"):""!==c.innerHTML?(a.innerHTML="",a.appendChild(c.cloneNode(!0))):a.innerHTML="var"}"Template"!==d.Type||-1===h.indexOf("</head>")?(c=a.getElementsByTagName("body")[0].innerHTML,d.Layout=encodeURIComponent(c.replace(/>var?<\//gim,
"></").replace(/&amp;/gim,"&"))):(c=(new XMLSerializer).serializeToString(a),d.Layout=encodeURIComponent(c.replace(/>var?<\//gim,"></")))}else d.Layout=c.innerHTML;a.push(d)});a.forEach((a)=>{let c=decodeURIComponent(a.Layout);a.Layout=encodeURIComponent(c.replace(/(<nice-editable-text .+?>)([\s\S]*?)(<\/nice-editable-text>)/g,"$2").replace(/(<nice-editable-text .+?>)([\s\S]*?)(<\/nice-editable-text>)/g,"$2"))});e||b.ajax("/api/nice-editor-items/save",{type:"PUT",data:JSON.stringify(a),contentType:"application/json",
success:function(){location.reload()},error:function(a){alert(a.message);location.reload()}});return!1});b(document).on("click",".nICE-clear-btn",function(){window.location=window.location.pathname+"?nice=0";return!1});b("body").append('<div class="nICE-control-panel">\n\t\t<button class="nICE-btn niceSaveBtn">\n\t\t\tSave\n\t\t\t<svg class="nICE-spinner" width="17px" height="17px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n\t\t\t</svg>\n\t\t</button>\n\t\t<button class="nICE-clear-btn niceExitBtn">EXIT nICE</button>\n\t</div>')}
function v(a){let b=/((^|"|')\s+?)(([a-z0-9_-]+?(($|\s+)))+)/gi;var c=a.matchAll(/<[a-z0-9_-]+([^>]*?\s([a-z0-9_-]+?(?=(\s|>)))[^>]*?)>/gi);for(const e of c){c=e[0];var d=e[1];let f=d.replace(b,function(a){return a.replace(/([a-z0-9_-])(\s|$)/gi,'$1=""$2')});d=c.replace(d,f);a=a.replace(c,d)}return a}var m=window.nicePropertiesScope;class w extends HTMLElement{constructor(){super()}}document.addEventListener("DOMContentLoaded",function(a){customElements.define("nice-editable-text",w);u();q()});String.prototype.matchAll=
function(a){var b=[];this.replace(a,function(){var a=[].slice.call(arguments,0),d=a.splice(-2);a.index=d[0];a.input=d[1];b.push(a)});return b.length?b:[]}})(jQuery);
