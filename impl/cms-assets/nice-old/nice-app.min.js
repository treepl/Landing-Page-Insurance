(function(){$nice(document).ready(function(){var c={};var b={};var e={};setInterval(function(){if($nice("body").attr("contenteditable")){$nice("body").removeAttr("contenteditable")}},100);$nice(document).on("click","button",'input[type="button"]',function(){return false});$nice("a, button").removeClass("waves-effect");$nice("label").removeAttr("for");$nice("[data-nice_component_holder]").each(function(){var i=$nice(this);var f=i.attr("data-nice_component_holder");var g=i.attr("data-nice_type");var h;i.find("*:not([data-nice_component_holder]) nice_editable_text").attr("data-nice_component_holder_id",f);i.find(">nice_editable_text").attr("data-nice_component_holder_id",f);b[f]={nice_template_id:i.data("nice_template_id"),nice_module_id:i.data("nice_module_id"),nice_layout_id:i.data("nice_layout_id"),nice_module_item_id:i.data("nice_module_item_id"),nice_property_alias:i.data("nice_property_alias"),nice_snippet_id:i.data("nice_snippet_id"),nice_form_id:i.data("nice_form_id"),nice_filepath:i.data("nice_filepath"),nice_code:i.data("nice_code"),nice_type:i.data("nice_type")};switch(g){case"Template":h=i.data("nice_template_id");break;case"Layout":h=i.data("nice_layout_id");break;case"ItemProperty":h=i.data("nice_module_item_id")+"_"+i.data("nice_property_alias");break;case"Snippet":h=i.data("nice_snippet_id");break;case"Form":h=i.data("nice_form_id");break;case"Include":h=i.data("nice_filepath");break}e[h]=e[h]||[];e[h].push(f)});d($nice("body component_holder"));$nice("[onclick]").each(function(){var g=$nice(this);var f=g.attr("onclick");g.attr("ondblclick",f).removeAttr("onclick")});$nice("nice_editable_text").attr("contenteditable",true);$nice("a").each(function(){var f=$nice(this);if(f.attr("href")){if(f.attr("href").indexOf("#")!=0&&f.attr("href")!="javascript:"){if(f.find("nice_editable_text").length){f.attr("data-href",f.attr("href"));f.attr("href","javascript:")}}else{f.attr("href","javascript:")}}else{f.attr("href","javascript:")}});$nice("a[data-href]").on("dblclick",function(){var f=$nice(this);if(f.data("href").length||f.data("href")!="#"||f.data("href")!="javascript:"){location=f.data("href")}return false});$nice("form").removeAttr("action");$nice(document).on("keyup keypress","[contenteditable]",function(){var k=$nice(this);var h=k.html().replace(/<br\s*\/?>/gm,"\r\n");h=h.replace(/(\<(\/?[^>]+)>)/gm,"");h=h.replace(/\r\n/gm,"<br />");h=h.replace(/<br\s*\/?>\s*$/g,"");h=h.replace(/\$/g,"$$$");var i=k.data("id");var n=k.data("nice_component_holder_id");var f=k.data("nice_editable_text_counter");var l;var o=new RegExp('(<nice_editable_text data-id="'+i+'" data-nice_editable_text_counter="'+f+'">)([\\s\\S]*?)(<\\/nice_editable_text>)',"g");var m=b[n];var j=m.nice_type;l=decodeURIComponent(m.nice_code);l=l.replace(o,"$1"+h+"$3");var g=encodeURIComponent(l);m.nice_code=g;l=l.replace(/(<nice_editable_text data-id=".+?">)([\s\S]*?)(<\/nice_editable_text>)/g,"$2");c[j]=c[j]||{};switch(j){case"Template":c[j][m.nice_template_id]=l;a(m.nice_template_id,f,h,n);break;case"Layout":c[j][m.nice_module_id]=c[j][m.nice_module_id]||{};c[j][m.nice_module_id][m.nice_layout_id]=l;a(m.nice_layout_id,f,h,n);break;case"ItemProperty":c[j][m.nice_module_id]=c[j][m.nice_module_id]||{};c[j][m.nice_module_id][m.nice_module_item_id]=c[j][m.nice_module_id][m.nice_module_item_id]||{};c[j][m.nice_module_id][m.nice_module_item_id][m.nice_property_alias]=l;a(m.nice_module_item_id+"_"+m.nice_property_alias,f,h,n);break;case"Snippet":c[j][m.nice_snippet_id]=l;a(m.nice_snippet_id,f,h,n);break;case"Form":c[j][m.nice_form_id]=l;a(m.nice_form_id,f,h,n);break;case"Include":c[j][m.nice_filepath]=l;a(m.nice_filepath,f,h,n);break}});$nice(document).on("focusout","[contenteditable]",function(){var g=$nice(this);var f=g.html().replace(/<br\s*\/?>/gm,"\r\n");f=f.replace(/(\<(\/?[^>]+)>)/gm,"");f=f.replace(/\r\n/gm,"<br />");f=f.replace(/<br\s*\/?>\s*$/g,"");g.html(f)});function a(l,k,j,h){for(var g=0;g<e[l].length;g++){var f=e[l][g];if(h!=f){$nice('nice_editable_text[data-nice_component_holder_id="'+f+'"][data-nice_editable_text_counter="'+k+'"]').html(j)}}}$nice(document).on("click",".niceSaveBtn",function(){$nice(".niceSaveBtn").addClass("saved");$nice.ajax("/api/nice-editor-items",{type:"PUT",data:c,success:function(){$nice(".niceSaveBtn").removeClass("saved")},error:function(f){alert(f.message);$nice(".niceSaveBtn").removeClass("saved")}});return false});$nice(document).on("click",".nICE-clear-btn",function(){location=location.pathname+"?nice=0";return false});$nice(document).on("click",function(){$nice("*").each(function(){$nice(this)[0].onselectstart=null})});$nice("body").append('<div class="nICE-control-panel">\n\t\t<button class="nICE-btn niceSaveBtn">\n\t\t\tSave\n\t\t\t<svg class="spinner" width="17px" height="17px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n\t\t\t</svg>\n\t\t</button>\n\t\t<button class="nICE-clear-btn">EXIT nICE</button>\n\t</div>');function d(f){f.each(function(){var h=$nice(this);var g=h.find(">*");if(!g.length&&h.html().length){g=h.html()}h.after(g);h.remove()});if($nice("component_holder").length){d($nice("body component_holder"))}}})})();