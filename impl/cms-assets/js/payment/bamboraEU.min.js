'use strict';(function(){function m(){function c(b,c){"CreditCard"===c?(b.style.display="block",b.dataset.paymentEnabled=!0):(b.style.display="none",b.dataset.paymentEnabled=!1)}let e=document.forms,k=[];var d=document.scripts;let h;for(var f=0;f<d.length;f++)if(-1!==d[f].src.indexOf("/cms-assets/js/payment/bamboraEU.min.js")){h=l(d[f].src,"checkout_integration");break}for(d=0;d<e.length;d++)if(e[d].elements.Payment_Data){f=e[d];var g=f.getAttribute("name");let b=`${g}_${d}`,c=document.getElementById(`paymentFields_${g}`);
g=document.getElementById(`paymentErrors_${g}`);c.id=`paymentFields_${b}`;g.id=`paymentErrors_${b}`;f.setAttribute("name",b);k.push(e[d])}k&&k.forEach((b,d)=>{function e(a,b=null){if(null===b)return a=a.form,"CreditCard"===a.elements.Payment_Type.value&&"Redirect"!==h?b=`/bambora/token?form=${l(a.action,"form")}`:(null===l(a.action,"jsonResponse")&&(a.action+=n(a.action)?"&":"?",a.action+="jsonResponse=1"),b=a.action),fetch(b,{method:"POST",body:new FormData(a)}).then(function(a){return a.json()}).then(function(a){f(a)}),
!1;b&&f(b)}function f(a){if("string"===typeof a)if("Modal"===h){let c=new Bambora.ModalCheckout(a);c.on(Bambora.Event.Close,function(a){b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:a.acceptUrl,LinkType:"SuccessPage",Response:a.data};b.dispatchEvent(b.CMS_AfterFormPaymentHandled)});setTimeout(()=>{c.show()},100)}else{if("Inline"===h){let c=new Bambora.InlineCheckout(a);g.classList.add("bambora-inline-holder");c.on("*",function(a,c){"authorize"===a&&(b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:c.acceptUrl,
LinkType:"SuccessPage",Response:c.data},b.dispatchEvent(b.CMS_AfterFormPaymentHandled))});setTimeout(()=>{c.mount(g)},100)}}else if("object"===typeof a)if(a.FormRedirectLink&&""!==a.FormRedirectLink&&!a.Error&&!a.ErrorCode){let c="SuccessPage";if("CreditCard"===b.elements.Payment_Type.value&&"Redirect"===h||"Paypal"===b.elements.Payment_Type.value)c="PaymentRedirect";b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:a.FormRedirectLink,LinkType:c,Response:a};b.dispatchEvent(b.CMS_AfterFormPaymentHandled)}else{if(a.Error||
a.ErrorCode)alert(a.Message||a.ErrorMessages.join("\r\n")),b.dataset.form_submitted=!1}else alert("Unknown error")}d=b.getAttribute("name");let g=document.getElementById(`paymentFields_${d}`);d=b["g-recaptcha-response-v3"]?"customFormSubmit":"submit";b.dataset.form_submitted=!1;c(g,b.elements.Payment_Type.value);b.addEventListener(d,function(a){a.preventDefault();a=a.target;"true"!==a.dataset.form_submitted?(b.CMS_AfterFormPaymentHandled=new Event("CMS_AfterFormPaymentHandled",{cancelable:!0}),a.CMS_CustomSubmit||
(b.CMS_CustomSubmit=new Event("CMS_CustomSubmit",{cancelable:!0})),a.dataset.form_submitted=!0,b.CMS_CustomSubmit.data={form:a},b.dispatchEvent(b.CMS_CustomSubmit)):alert("Form submission is in progress.")});b.addEventListener("CMS_CustomSubmit",function(a){a.defaultPrevented?a.data.form.dataset.form_submitted=!1:e(a.data)});b.addEventListener("CMS_triggerHandlePayment",function(a){e(a.data.submitData,a.data.response)});b.addEventListener("CMS_AfterFormPaymentHandled",function(a){a.defaultPrevented||
(window.location=a.data.FormRedirectLink)})})}function l(c,e){c=new URL(c);return(new URLSearchParams(c.search)).get(e)}function n(c){c=new URL(c);c=new URLSearchParams(c.search);let e=0;for(let k of c)e++;return e}document.addEventListener("DOMContentLoaded",function(c){setTimeout(()=>{m()},0)})})();
