'use strict';(function(){function k(){function d(b,c,e,d){if("CreditCard"===c){if(!l)throw Error("Missing stripe key");b.style.display="block";b.dataset.paymentEnabled=!0;e.mount(`#paymentFields_${d}`)}else b.style.display="none",e.unmount(`#paymentFields_${d}`),b.dataset.paymentEnabled=!1}var e=document.forms;let f=document.scripts,l="",h=[];var c=window.paymentGatewaySettings;let k={style:{base:{backgroundColor:c?c.style.backgroundColor:"",color:c?c.style.color:"#32325d",fontSmoothing:c?c.style.fontSmoothing:
"antialiased",fontSize:c?c.style.fontSize:"16px",lineHeight:c?c.style.lineHeight:"16px","::placeholder":{color:c?c.style.placeholderColor:"#444"},iconColor:c?c.style.iconColor:"#32325d"},invalid:{color:c?c.style.invalidColor:"#fa755a",iconColor:c?c.style.invalidIconColor:"#fa755a"}},hideIcon:c?c.hideIcon:!1,iconStyle:c?c.iconStyle:"default",hidePostalCode:c?c.hidePostalCode:!0};for(c=0;c<e.length;c++)if(e[c].elements.Payment_Data){let b=e[c];var g=b.getAttribute("name");let d=`${g}_${c}`,f=document.getElementById(`paymentFields_${g}`);
g=document.getElementById(`paymentErrors_${g}`);f.id=`paymentFields_${d}`;g.id=`paymentErrors_${d}`;b.setAttribute("name",d);h.push(e[c])}for(e=0;e<f.length;e++)if(-1!==f[e].src.indexOf("/cms-assets/js/payment/stripe.min.js")){l=r(f[e].src,"key");break}h&&h.forEach((b)=>{function c(b){return m.createPaymentMethod({type:"card",card:n,billing_details:{email:b.elements.Email.value}}).then(function(a){return a.error?(document.getElementById(`paymentErrors_${p}`).textContent=a.error.message,b.dataset.form_submitted=
!1):a.paymentMethod})}function e(a){a&&(b.elements.Payment_Data.value=a.id,b.CMS_CustomSubmit.data={form:b,paymentMethod:a},b.dispatchEvent(b.CMS_CustomSubmit))}function f(a){null===r(b.action,"jsonResponse")&&(b.action+=u(b.action)?"&":"?",b.action+="jsonResponse=1");fetch(b.action,{method:"POST",body:new FormData(b)}).then(function(b){return b.json()}).then(function(b){g(b,a)})}function g(a,c){a.Error&&0!=a.Error?(alert(a.ErrorMessages.join("\r\n")),b.dataset.form_submitted=!1):a.FormRedirectLink&&
""!==a.FormRedirectLink?(c="SuccessPage","Paypal"===b.elements.Payment_Type.value&&(c="PaymentRedirect"),b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:a.FormRedirectLink,LinkType:c,Response:a},b.dispatchEvent(b.CMS_AfterFormPaymentHandled)):"RequiresAction"===a.PaymentState&&h(a.PaymentIntentClientSecret,c.paymentMethod.id,a.OrderId)}function h(a,c,d){return m.confirmCardPayment(a,{payment_method:c,return_url:`${location.origin}/checkout-response`},{handleActions:!1}).then(function(a){if("requires_action"===
a.paymentIntent.status){let c=a.paymentIntent.next_action;c&&"redirect_to_url"===c.type&&(a.OrderId=d,b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:c.redirect_to_url.url,LinkType:"3DSecure",Response:a},b.dispatchEvent(b.CMS_AfterFormPaymentHandled))}else if("succeeded"===a.paymentIntent.status||"requires_capture"===a.paymentIntent.status)b.CMS_AfterFormPaymentHandled.data={FormRedirectLink:`${location.origin}/checkout-response?payment_intent=${a.paymentIntent.id}&payment_intent_client_secret=${a.paymentIntent.client_secret}&source_type=${a.paymentIntent.payment_method_types[0]}`,
LinkType:"SuccessPage",Response:a},b.dispatchEvent(b.CMS_AfterFormPaymentHandled);else if(a.error)return document.getElementById("paymentErrors_stripe3DSecureForm").textContent=a.error.message,b.dataset.form_submitted=!1})}let m=Stripe(l);var q=m.elements();let p=b.getAttribute("name"),n=q.create("card",k),t=document.getElementById(`paymentFields_${p}`);q=b["g-recaptcha-response-v3"]?"customFormSubmit":"submit";b.dataset.form_submitted=!1;d(t,b.elements.Payment_Type.value,n,p);b.elements.Payment_Type.onchange=
function(a){a.preventDefault();d(t,a.target.value,n,b.name)};b.addEventListener(q,function(a){a.preventDefault();a=a.target;"true"!==a.dataset.form_submitted?(b.CMS_AfterFormPaymentHandled=new Event("CMS_AfterFormPaymentHandled",{cancelable:!0}),a.CMS_CustomSubmit||(b.CMS_CustomSubmit=new Event("CMS_CustomSubmit",{cancelable:!0})),a.dataset.form_submitted=!0,"CreditCard"===a.elements.Payment_Type.value?c(a).then(e):(b.CMS_CustomSubmit.data={form:a},b.dispatchEvent(b.CMS_CustomSubmit))):alert("Form submission is in progress.")});
b.addEventListener("CMS_CustomSubmit",function(a){a.defaultPrevented?a.data.form.dataset.form_submitted=!1:f(a.data)});b.addEventListener("CMS_triggerHandlePayment",function(a){a.data.response?g(a.data.response,a.data.submitData):f(a.data.submitData)});b.addEventListener("CMS_AfterFormPaymentHandled",function(a){a.defaultPrevented||(window.location=a.data.FormRedirectLink)})})}function r(d,e){d=new URL(d);return(new URLSearchParams(d.search)).get(e)}function u(d){d=new URL(d);d=new URLSearchParams(d.search);
let e=0;for(let f of d)e++;return e}document.addEventListener("DOMContentLoaded",function(d){setTimeout(()=>{k()},0)})})();
